<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <title>Our simple HTTP server</title>

  <link rel="stylesheet" href="https://unpkg.com/tippy.js@6/animations/shift-away.css" />
  <link rel="stylesheet" href="https://unpkg.com/tippy.js@6/dist/backdrop.css" />
  <link rel="stylesheet" type="text/css" href="/style.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-core/5.8.34/browser.min.js"></script>
  <script src="https://unpkg.com/@popperjs/core@2"></script>
  <script src="https://unpkg.com/tippy.js@6"></script>

  <script type="text/babel">
    let controls = {
      headerCheck: null,
      headerLoad: null,
      headerFind: null,
      headerStatus: null,
      selectorSpecies: null,
      selectorPattern: null,
      selectorOutfit: null,
      selectorWeapon: null,
      selectorImages: null,
      characterSave: null,
      characterReset: null,
      characterStats: null,
      characterName: null,
    }

    const options = {
      species: [
        'werewolf',
        'weremoth',
        'chupacabra',
        'ahool',
        'jersey devil',
      ],
      pattern: [
        'plain',
        'light',
        'dark',
        'gradient',
        'spotted',
      ],
      outfit: [
        'nothing',
        'light robes',
        'heavy robes',
        'light armor',
        'heavy armor',
      ],
      weapon: [
        'unarmed',
        'bow',
        'daggers',
        'staff',
        'sword and shield',
      ]
    }

    const getCurrentValues = () => {
      return [
        controls.selectorSpecies.dataset.selected,
        controls.selectorPattern.dataset.selected,
        controls.selectorOutfit.dataset.selected,
        controls.selectorWeapon.dataset.selected,
      ];
    }

    const replaceUrl = (urlToUse) => {
      const patterns = controls.selectorPattern.querySelectorAll('.portrait > div');
      const outfits = controls.selectorOutfit.querySelectorAll('.portrait > div');
      const weapons = controls.selectorWeapon.querySelectorAll('.portrait > div');

      patterns.forEach((child) => {
        child.style.backgroundImage = `url(${urlToUse})`;
      });

      outfits.forEach((child) => {
        child.style.backgroundImage = `url(${urlToUse})`;
      });

      weapons.forEach((child) => {
        child.style.backgroundImage = `url(${urlToUse})`;
      });
      
      controls.selectorImages.forEach((child) => {
        child.style.backgroundImage = `url(${urlToUse})`;
      });
    };

    const setRightPanelImages = (currentValues) => {
      for (let i = 0; i < controls.selectorImages.length; i++) {
        controls.selectorImages[i].style.backgroundPosition = `${25 * currentValues[i]}% ${25 * i}%`;
      }
    };

    const setupImages = (group, optionsForGroup, rowInSheet) => {
      for (let i = 0; i < optionsForGroup.length; i++) {
        let el = document.createElement('div');
        el.classList.add('portrait');
        const pos = `background-position: ${25 * i}% ${25 * rowInSheet}%`;
        const size = `background-size: ${7.2*optionsForGroup.length}vh`;
        const url = `background-image: url(werewolf.png)`;
        el.innerHTML = `
          <div
            style="${pos}; ${size}; ${url};"
          ></div>
          <p>${optionsForGroup[i]}</p>
        `;
        group.appendChild(el);
      }

      controls.selectorImages.forEach((child) => {
        child.style.backgroundImage = 'url(werewolf.png)';
      });
    };

    const setupSelectors = (group, key) => {
      group.dataset.selected = 0;
      let children = group.querySelectorAll('.portrait');
      children[0].classList.add('selected');
      for (let i = 0; i < children.length; i++) {
        children[i].dataset.value = i;
        children[i].dataset.target = key;
        children[i].addEventListener('click', (e) => {
          let caller = e.target;
          if (!caller.classList.contains('portrait')) {
            caller = caller.parentNode;
          }
          // set the controls parent group value
          // to the value of the event target
          // using event target's target as key
          controls[caller.dataset.target].dataset.selected = caller.dataset.value;
          for (const child of controls[caller.dataset.target].children) {
            child.classList.remove('selected');
          }
          caller.classList.add('selected');

          if (caller.dataset.target === 'selectorSpecies') {
            replaceUrl(`${options.species[caller.dataset.value].replace(' ', '_')}.png`);
          }

          setRightPanelImages(getCurrentValues());
        });
      }
    };

    const validate = () => {
      if ((document.querySelectorAll('input:invalid') || []).length > 0) {
        return false;
      }
      return true;
    };

    window.onload = () => {
      controls.selectorSpecies = document.querySelector('#selector-species');
      controls.selectorPattern = document.querySelector('#selector-pattern');
      controls.selectorOutfit = document.querySelector('#selector-outfit');
      controls.selectorWeapon = document.querySelector('#selector-weapon');
      controls.selectorImages = document.querySelectorAll('#panel-right .preview div');
      setupImages(controls.selectorSpecies, options.species, 0);
      setupImages(controls.selectorPattern, options.pattern, 1);
      setupImages(controls.selectorOutfit, options.outfit, 2);
      setupImages(controls.selectorWeapon, options.weapon, 3);
      setupSelectors(controls.selectorSpecies, 'selectorSpecies');
      setupSelectors(controls.selectorPattern, 'selectorPattern');
      setupSelectors(controls.selectorOutfit, 'selectorOutfit');
      setupSelectors(controls.selectorWeapon, 'selectorWeapon');
      setRightPanelImages(getCurrentValues());

      const defaultTooltipOptions = {
        allowHTML: true,
        animateFill: true,
        animation: 'shift-away',
        appendTo: () => document.body,
        followCursor: 'horizontal',
        inertia: true,
        interactive: true,
        maxWidth: 300,
      }
      controls.headerCheck = {
        control: document.querySelector('#in-check'),
        tooltip: tippy('#in-check', {
          ...defaultTooltipOptions,
          content: 'Check whether the character with the inputted name exists<br/>DEV NOTE: Performs <code>HEAD</code> request',
        }),
      };
      controls.headerLoad = {
        control: document.querySelector('#in-load'),
        tooltip: tippy('#in-load', {
          ...defaultTooltipOptions,
          content: 'Loads a character into the creator (assuming the inputted name exists)<br/>DEV NOTE: Performs <code>GET</code> request',
        }),
      };
      controls.headerFind = {
        control: document.querySelector('#in-find'),
        tooltip: tippy('#in-find', {
          ...defaultTooltipOptions,
          content: 'The name of the character to search/load (case and space sensitive)',
        }),
      };
      controls.headerStatus = {
        control: document.querySelector('#out-header-status span'),
        tooltip: tippy('#out-header-status span', {
          ...defaultTooltipOptions,
          content: '',
        }),
      };
      controls.characterName = {
        control: document.querySelector('#in-name'),
        tooltip: tippy('#in-name', {
          ...defaultTooltipOptions,
          content: 'The name of the character (will be case/space sensitive when searching)',
        }),
      };
      controls.characterSave = {
        control: document.querySelector('#in-save'),
        tooltip: tippy('#in-save', {
          ...defaultTooltipOptions,
          content: 'Saves the character',
        }),
      };
      controls.characterReset = {
        control: document.querySelector('#in-reset'),
        tooltip: tippy('#in-reset', {
          ...defaultTooltipOptions,
          content: 'Resets all stat/name inputs back to default',
        }),
      };
      controls.characterStats = [
        {
          control: document.querySelector('#in-stat-per'),
          tooltip: tippy('#in-stat-per', {
            ...defaultTooltipOptions,
            content: 'Character\'s perception',
          }),
        },
        {
          control: document.querySelector('#in-stat-wit'),
          tooltip: tippy('#in-stat-wit', {
            ...defaultTooltipOptions,
            content: 'Character\'s wit',
          }),
        },
        {
          control: document.querySelector('#in-stat-wil'),
          tooltip: tippy('#in-stat-wil', {
            ...defaultTooltipOptions,
            content: 'Character\'s will',
          }),
        },
        {
          control: document.querySelector('#in-stat-end'),
          tooltip: tippy('#in-stat-end', {
            ...defaultTooltipOptions,
            content: 'Character\'s endurance',
          }),
        },
        {
          control: document.querySelector('#in-stat-str'),
          tooltip: tippy('#in-stat-str', {
            ...defaultTooltipOptions,
            content: 'Character\'s strength',
          }),
        },
        {
          control: document.querySelector('#in-stat-agi'),
          tooltip: tippy('#in-stat-agi', {
            ...defaultTooltipOptions,
            content: 'Character\'s agility',
          }),
        },
      ]

      controls.characterSave.control.addEventListener('click', (e) => {
        if (validate()) {
          console.log('valid info!');
        } else {
          console.log('invalid info!');
        }
      });
      controls.characterReset.control.addEventListener('click', (e) => {
        controls.characterName.control.value = '';
        controls.characterStats.forEach((controlRef) => {
          controlRef.control.value = 0;
        });
      });
    };
  </script>
</head>
<body>
  <header
    class="panel"
  >
    <h1>Cryptid Keeper</h1>
    <div
      class="control-group"
      id="header-controls"
    >
      <div
        class="control control-text"
      >
        <input
          id="in-find"
          type="text"
          placeholder=""
        />
        <label
          for="in-find"
        >
          find
        </label>
      </div>

      <div
        class="control control-button"
      >
        <button
          id="in-check"
        >
          Check
        </button>
      </div>

      <div
        class="control control-button"
      >
        <button
          id="in-load"
        >
          Load
        </button>
      </div>

      <div
        class="status"
        id="out-header-status"
      >
        <span></span>
      </div>
    </div>
  </header>

  <main>
    <div
      class="panel"
      id="panel-left"
    >
      <!-- Species -->
      <div
        class="selector"
        id="selector-species"
      >
      </div>

      <!-- Pattern -->
      <div
        class="selector"
        id="selector-pattern"
      >
      </div>

      <!-- Outfit -->
      <div
        class="selector"
        id="selector-outfit"
      >
      </div>

      <!-- Weapon -->
      <div
        class="selector"
        id="selector-weapon"
      >
      </div>

    </div>

    <div
      class="panel"
      id="panel-right"
    >
      <div
        class="preview"
      >
        <div></div>
        <div></div>
        <div></div>
        <div></div>
      </div>
      <div
        class="control control-text"
      >
        <input
          id="in-name"
          type="text"
          placeholder=""
          required
        />
        <label
          for="in-name"
        >
          name
        </label>
      </div>
      <div
        id="group-stats"
        class="control-group"
      >
        <div
          class="control control-text"
        >
        <input
          id="in-stat-per"
          type="number"
          value="0"
          required
          min="-10"
          max="10"
        />
        <label
          for="in-stat-per"
        >
          PER
        </label>
        </div>
        <div
          class="control control-text"
        >
        <input
          id="in-stat-wit"
          type="number"
          value="0"
          required
          min="-10"
          max="10"
        />
        <label
          for="in-stat-wit"
        >
          WIT
        </label>
        </div>
        <div
          class="control control-text"
        >
        <input
          id="in-stat-wil"
          type="number"
          value="0"
          required
          min="-10"
          max="10"
        />
        <label
          for="in-stat-wil"
        >
          WIL
        </label>
        </div>
        <div
          class="control control-text"
        >
        <input
          id="in-stat-end"
          type="number"
          value="0"
          required
          min="-10"
          max="10"
        />
        <label
          for="in-stat-end"
        >
          END
        </label>
        </div>
        <div
          class="control control-text"
        >
        <input
          id="in-stat-str"
          type="number"
          value="0"
          required
          min="-10"
          max="10"
        />
        <label
          for="in-stat-str"
        >
          STR
        </label>
        </div>
        <div
          class="control control-text"
        >
        <input
          id="in-stat-agi"
          type="number"
          value="0"
          required
          min="-10"
          max="10"
        />
        <label
          for="in-stat-agi"
        >
          AGI
        </label>
        </div>
      </div>
      <div
        class="control-group"
      >
        <div
          class="control control-button"
        >
          <button
            id="in-save"
          >
            Save
          </button>
        </div>
        <div
          class="control control-button"
        >
          <button
            id="in-reset"
          >
            Reset
          </button>
        </div>
      </div>
    </div>
  </main>
</body>
</html>